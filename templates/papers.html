<!DOCTYPE html>
<html>

<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-GTBGKSY5SM"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', GA_MEASUREMENT_ID);
    </script>

    <title>arXiv Papers</title>
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                processEscapes: true,
                macros: {
                    RR: "\\mathbb{R}",
                    VV: "\\mathbb{V}",
                    VVV: "\\mathcal{V}",
                    ZZ: "\\mathbb{Z}"
                }
            }
        };
    </script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" async></script>
</head>


<body>
    <div style="display:flex;gap:12px;align-items:center;margin-bottom:12px;">
        {% if user %}
        <img src="{{ user.picture }}" referrerpolicy="no-referrer" style="width:28px;height:28px;border-radius:50%">
        <span>Signed in as {{ user.name or user.email }}</span>
        <a href="/logout">Logout</a>
        {% else %}
        <a href="/login">Sign in with Google</a>
        {% endif %}
    </div>
    <h1>arXiv Papers</h1>
    <!-- Main Category Filters -->
    <div id="category-filters">
        <label for="main-category">Filter by Category:</label>
        <select id="main-category" onchange="filterByMainCategory()">
            <option value="all">All</option>
            <option value="math">Mathematics</option>
            <option value="cs">Computer Science</option>
            <option value="physics">Physics</option>
            <option value="stat">Statistics</option>
            <option value="q-bio">Quantitative Biology</option>
            <option value="q-fin">Quantitative Finance</option>
            <option value="eess">Electrical Engineering & Systems Science</option>
            <option value="econ">Economics</option>
        </select>
    </div>

    <div id="subcategory-filters" style="display: none;">
        <label for="sub-category">Filter by Subcategory:</label>
        <select id="sub-category" onchange="filterBySubCategory()">
            <option value="all">All</option>
        </select>
    </div>
    {% for paper in papers %}
    {% set primary = paper.categories | selectattr("is_primary") | list | first %}
    <div class="paper" data-main="{{ primary.term.split('.')[0] if primary else 'unknown' }}"
        data-sub="{{ paper.categories | map(attribute='term') | join(',') }}">

        <h2>{{ paper.title }}</h2>
        <p><strong>Published:</strong> {{ paper.published }}</p>
        <!-- <p><strong>Updated:</strong> {{ paper.updated }}</p> -->
        <p><strong>Authors:</strong> {{ paper.authors }}</p>

        {% if paper.categories %}
        <p><strong>Categories:</strong>
            {% for category in paper.categories %}
            {% if category.is_primary %}
            <span><strong>{{ category.term }}</strong></span>{% if not loop.last %}, {% endif %}
            {% else %}
            <span>{{ category.term }}</span>{% if not loop.last %}, {% endif %}
            {% endif %}
            {% endfor %}
        </p>
        {% endif %}

        <p><strong>Abstract:</strong><br>{{ paper.summary | safe }}</p>
        <p>
            <a href="{{ paper.url }}">arXiv Page</a> |
            <a href="{{ paper.pdf_url }}">PDF</a>
        </p>
        <hr>
    </div>
    <!-- <hr> -->
    {% endfor %}

    <script>
        window.addEventListener("load", () => {
            if (window.MathJax) {
                MathJax.typeset();
            }
        });
    </script>
    <script>
        function filterByMainCategory() {
            const selected = document.getElementById('main-category').value;
            const papers = document.querySelectorAll('.paper');

            papers.forEach(paper => {
                const mainCategory = paper.getAttribute('data-main');
                if (selected === 'all' || mainCategory === selected) {
                    paper.style.display = '';
                } else {
                    paper.style.display = 'none';
                }
            });
        }
    </script>
    <script>
        const subcategoryMap = {};

        document.addEventListener("DOMContentLoaded", () => {
            const papers = document.querySelectorAll('.paper');

            // Build subcategory map
            papers.forEach(paper => {
                const main = paper.getAttribute('data-main');
                const subs = paper.getAttribute('data-sub').split(',');

                if (!subcategoryMap[main]) {
                    subcategoryMap[main] = new Set();
                }

                subs.forEach(sub => {
                    if (sub.startsWith(main)) {
                        subcategoryMap[main].add(sub);
                    }
                });
            });
        });

        function filterByMainCategory() {
            const selectedMain = document.getElementById('main-category').value;
            const subFilterDiv = document.getElementById('subcategory-filters');
            const subSelect = document.getElementById('sub-category');

            // Update subcategory dropdown
            if (selectedMain === 'all') {
                subFilterDiv.style.display = 'none';
            } else {
                subFilterDiv.style.display = 'block';
                subSelect.innerHTML = '<option value="all">All</option>';

                const subs = Array.from(subcategoryMap[selectedMain] || []).sort();
                for (const sub of subs) {
                    const option = document.createElement('option');
                    option.value = sub;
                    option.textContent = sub;
                    subSelect.appendChild(option);
                }
            }

            filterPapers();
        }

        function filterBySubCategory() {
            filterPapers();
        }

        function filterPapers() {
            const selectedMain = document.getElementById('main-category').value;
            const selectedSub = document.getElementById('sub-category').value;
            const papers = document.querySelectorAll('.paper');

            papers.forEach(paper => {
                const main = paper.getAttribute('data-main');
                const subs = paper.getAttribute('data-sub').split(',');

                const matchMain = (selectedMain === 'all' || main === selectedMain);
                const matchSub = (selectedSub === 'all' || subs.includes(selectedSub));

                if (matchMain && matchSub) {
                    paper.style.display = '';
                } else {
                    paper.style.display = 'none';
                }
            });
        }
    </script>

</body>

</html>